<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sky3D: coulomb Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Sky3D
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('namespacecoulomb.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">coulomb Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This module offers the subroutine <code>poisson</code>, which calculates the Coulomb potential from the proton density. The two boundary conditions allowed are distinguished by the value of the variable periodic. If it is true, the mesh is assumed to be periodic in all three directions and the Poisson equation is solved using the <img class="formulaInl" alt="$\frac{1}{k^2}$" src="form_0.png"/> Green’s function in momentum space and assuming a homogeneous negative background annulling the total charge (jellium approximation). Otherwise the boundary condition is for an isolated charge distribution. In this case the potential is calculated by the method of doubling the grid in all directions with zero density, folding with the 1/r-potential in momentum space and then restricting to the physical region.  
<a href="namespacecoulomb.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a5f0400055fa5aa4cbfc054c9e1bf565b"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecoulomb.html#a5f0400055fa5aa4cbfc054c9e1bf565b">poisson</a> (rhocharge)</td></tr>
<tr class="memdesc:a5f0400055fa5aa4cbfc054c9e1bf565b"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine solves the Poisson equation by the Fourier method.  <a href="namespacecoulomb.html#a5f0400055fa5aa4cbfc054c9e1bf565b">More...</a><br /></td></tr>
<tr class="separator:a5f0400055fa5aa4cbfc054c9e1bf565b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74649b61a8f2de130fb95edb9a62d498"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecoulomb.html#a74649b61a8f2de130fb95edb9a62d498">coulinit</a></td></tr>
<tr class="memdesc:a74649b61a8f2de130fb95edb9a62d498"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine does the necessary initialization.  <a href="namespacecoulomb.html#a74649b61a8f2de130fb95edb9a62d498">More...</a><br /></td></tr>
<tr class="separator:a74649b61a8f2de130fb95edb9a62d498"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee5145182fc0abb626eaa2850a87826c"><td class="memItemLeft" align="right" valign="top">subroutine, private&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecoulomb.html#aee5145182fc0abb626eaa2850a87826c">initiq</a> (n, d, iq)</td></tr>
<tr class="memdesc:aee5145182fc0abb626eaa2850a87826c"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine calculates the contributions of each Cartesian index to <img class="formulaInl" alt="$r^2$" src="form_34.png"/> and <img class="formulaInl" alt="$k^{-2}$" src="form_35.png"/>.  <a href="namespacecoulomb.html#aee5145182fc0abb626eaa2850a87826c">More...</a><br /></td></tr>
<tr class="separator:aee5145182fc0abb626eaa2850a87826c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a26740de741e0c1efe01fe26e5c996135"><td class="memItemLeft" align="right" valign="top">real(db), dimension(:,:,:), allocatable, save, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecoulomb.html#a26740de741e0c1efe01fe26e5c996135">wcoul</a></td></tr>
<tr class="memdesc:a26740de741e0c1efe01fe26e5c996135"><td class="mdescLeft">&#160;</td><td class="mdescRight"><br  />
  <a href="namespacecoulomb.html#a26740de741e0c1efe01fe26e5c996135">More...</a><br /></td></tr>
<tr class="separator:a26740de741e0c1efe01fe26e5c996135"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9f62c9032d70f15617f01a0c9ecb0c7"><td class="memItemLeft" align="right" valign="top">complex(db), dimension(:,:,:), allocatable, save, private&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecoulomb.html#ad9f62c9032d70f15617f01a0c9ecb0c7">q</a></td></tr>
<tr class="memdesc:ad9f62c9032d70f15617f01a0c9ecb0c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">array for the complex Green’s function (isolated) or array of 1/r values. Its dimension also depends on the boundary condition.  <a href="namespacecoulomb.html#ad9f62c9032d70f15617f01a0c9ecb0c7">More...</a><br /></td></tr>
<tr class="separator:ad9f62c9032d70f15617f01a0c9ecb0c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr><td colspan="2"><div class="groupHeader">Dimensions of the grid on which the Fourier transform is calculated.</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p>For the periodic case they are identical to the regular dimensions, for the isolated case they are doubled. </p>
</div></td></tr>
<tr class="memitem:a821f17159bc941612225823801555733"><td class="memItemLeft" align="right" valign="top">integer, private&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecoulomb.html#a821f17159bc941612225823801555733">nx2</a></td></tr>
<tr class="separator:a821f17159bc941612225823801555733"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec5bb921ae0a248b7ce45c157e9d793d"><td class="memItemLeft" align="right" valign="top">integer, private&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecoulomb.html#aec5bb921ae0a248b7ce45c157e9d793d">ny2</a></td></tr>
<tr class="separator:aec5bb921ae0a248b7ce45c157e9d793d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0de0e5b7d18f4ce88eeb7ea25839149a"><td class="memItemLeft" align="right" valign="top">integer, private&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecoulomb.html#a0de0e5b7d18f4ce88eeb7ea25839149a">nz2</a></td></tr>
<tr class="separator:a0de0e5b7d18f4ce88eeb7ea25839149a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr><td colspan="2"><div class="groupHeader">Plans for FFTW complex forward and reverse transforms</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p>with array dimensions depending on the boundary condition. </p>
</div></td></tr>
<tr class="memitem:a20877fe904a19406549cfc1e10b30128"><td class="memItemLeft" align="right" valign="top">integer(c_long), save, private&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecoulomb.html#a20877fe904a19406549cfc1e10b30128">coulplan1</a></td></tr>
<tr class="separator:a20877fe904a19406549cfc1e10b30128"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfd1cdc755ebb2f0adcd1d1ce1cf4503"><td class="memItemLeft" align="right" valign="top">integer(c_long), save, private&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecoulomb.html#abfd1cdc755ebb2f0adcd1d1ce1cf4503">coulplan2</a></td></tr>
<tr class="separator:abfd1cdc755ebb2f0adcd1d1ce1cf4503"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This module offers the subroutine <code>poisson</code>, which calculates the Coulomb potential from the proton density. The two boundary conditions allowed are distinguished by the value of the variable periodic. If it is true, the mesh is assumed to be periodic in all three directions and the Poisson equation is solved using the <img class="formulaInl" alt="$\frac{1}{k^2}$" src="form_0.png"/> Green’s function in momentum space and assuming a homogeneous negative background annulling the total charge (jellium approximation). Otherwise the boundary condition is for an isolated charge distribution. In this case the potential is calculated by the method of doubling the grid in all directions with zero density, folding with the 1/r-potential in momentum space and then restricting to the physical region. </p>
<p>The Coulomb solver follows the ideas of <b>[Eas79]</b>. We summarize here the way it is realized in the code without detailed proofs.</p>
<p>Two grids are used. We will call them here <img class="formulaInl" alt="$\mathcal{G}_1$" src="form_1.png"/> and <img class="formulaInl" alt="$\mathcal{G}_2$" src="form_2.png"/>. The grid <img class="formulaInl" alt="$\mathcal{G}_1$" src="form_1.png"/> is our standard working grid. We repeat here the essentials </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \mathcal{G}_1:\;&amp; \nu_x=1,...,{\tt nx}\;,\; \nu_y=1,...,{\tt ny}\;,\; \nu_z=1,...,{\tt nz}\;;\; \\&amp; \mbox{coordinate spacing: } {\tt dx}, {\tt dy}, {\tt dz}; \\&amp; \mbox{momentum spacing: } {\tt dk}_x = \frac{2\pi}{{\tt nx}\!\cdot\!{\tt dx}}, {\tt dk}_y = \frac{2\pi}{{\tt ny}\!\cdot\!{\tt dy}}, {\tt dk}_z = \frac{2\pi}{{\tt nz}\!\cdot\!{\tt dz}}; \end{eqnarray*}" src="form_3.png"/>
</p>
<p> The second grid amounts to a doubled box in each direction, thus </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \mathcal{G}_2:\;&amp; \nu_x=1,...,2{\tt nx}\;,\; \nu_y=1,...,2{\tt ny}\;,\; \nu_z=1,...,2{\tt nz}\;;\; \\&amp; x_{\nu_x}=(\nu_x\!-\!{\tt nx}){\tt dx}\,,\, y_{\nu_y}=(\nu_y\!-\!{\tt ny}){\tt dy}\,,\, z_{\nu_z}=(\nu_z\!-\!{\tt nz}){\tt dz}\,; \\&amp; \mbox{momentum spacing: } {\tt dk}_x = \frac{2\pi}{{2\tt nx}\!\cdot\!{\tt dx}}, {\tt dk}_y = \frac{2\pi}{{2\tt ny}\!\cdot\!{\tt dy}}, {\tt dk}_z = \frac{2\pi}{{2\tt nz}\!\cdot\!{\tt dz}}; \end{eqnarray*}" src="form_4.png"/>
</p>
<p> The momenta <img class="formulaInl" alt="$k_{n_i}$" src="form_5.png"/> in <img class="formulaInl" alt="$\mathcal{G}_2$" src="form_2.png"/> are arranged around <img class="formulaInl" alt="$k=0$" src="form_6.png"/> similar as in <img class="formulaInl" alt="$\mathcal{G}_1$" src="form_1.png"/>, but with half spacing <img class="formulaInl" alt="${\tt dk}_i$" src="form_7.png"/>. For simplicity, we will use compact notation <img class="formulaInl" alt="$\mathbf{r}_{\bnu}=\left(x_{\nu_x},y_{\nu_y},z_{\nu_z}\right)$" src="form_8.png"/> and similarly for <img class="formulaInl" alt="$\mathbf{k}_\mathbf{n}$" src="form_9.png"/>.</p>
<p>First, the Coulomb solver has to be initialized by defining the appropriate Greens function which is done on <img class="formulaInl" alt="$\mathcal{G}_2$" src="form_2.png"/>. The two necessary steps are:</p><ol type="1">
<li>Prepare the Greens function in r-space as <p class="formulaDsp">
<img class="formulaDsp" alt="\[ G(\mathbf{r}_{\bnu})=\frac{e^2}{|\mathbf{r}_{\bnu}|} \]" src="form_10.png"/>
</p>
 Special consideration has to be given to the singularity of the <img class="formulaInl" alt="$ 1/r $" src="form_11.png"/> potential. In the discretized version, the value at <img class="formulaInl" alt="$ \vec r=0 $" src="form_12.png"/> should be replaced by the average of <img class="formulaInl" alt="$ 1/r $" src="form_11.png"/> over a cuboid of size <img class="formulaInl" alt="$\Delta x\times\Delta y\times\Delta z $" src="form_13.png"/>. For equal spacing in all three directions this would lead to a value of <img class="formulaInl" alt="$ 2.38/\Delta x $" src="form_14.png"/>. Practical experimentation, however, showed that the underlying assumption of a point charge can be improved by some smeared-out density for nuclear applications; a value of <img class="formulaInl" alt="$ 2.84/\Delta x $" src="form_15.png"/> was found to be optimal. <br  />
 We use the expression <p class="formulaDsp">
<img class="formulaDsp" alt="\[ G(0) = \frac{2.84\sqrt{3}}{\sqrt{{\tt dx}^2+{\tt dy}^2+{\tt dz}^2}} \quad.\]" src="form_16.png"/>
</p>
</li>
<li>Prepare the Greens function in <img class="formulaInl" alt="$ k $" src="form_17.png"/>-space by 3D fast Fourier transformation (FFT) on the double grid <img class="formulaInl" alt="$\mathcal{G}_2$" src="form_2.png"/>. <img class="formulaInl" alt="$\tilde{G}(\mathbf{k}_{\bmu})={\tt FFT}\{G(\mathbf{r}_{\bnu})\}$" src="form_18.png"/>. The array <img class="formulaInl" alt="$ \tilde{G}(\mathbf{k}_{\bmu}) $" src="form_19.png"/> is stored for further continued use.</li>
</ol>
<p>Once properly prepared, the practical steps for computing the Coulomb field <img class="formulaInl" alt="$ U_\mathrm{Coul}(\mathbf{r}_{\bnu}) $" src="form_20.png"/> for a density <img class="formulaInl" alt="$\rho(\mathbf{r}_{\bnu})$" src="form_21.png"/> given on <img class="formulaInl" alt="$\mathcal{G}_1$" src="form_1.png"/> are</p><ol type="1">
<li>Extend <img class="formulaInl" alt="$ \rho_{\bnu} $" src="form_22.png"/> from <img class="formulaInl" alt="$ \mathcal{G}_1 $" src="form_23.png"/> to <img class="formulaInl" alt="$ \mathcal{G}_2 $" src="form_24.png"/> by zero padding: <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \rho_2(\mathbf{r}_{\bnu}) = \left\{\begin{array}{lcl} \rho(\mathbf{r}_{\bnu}) &amp;\mbox{ if }&amp; 1\leq \nu_i \leq {\tt n}i \mbox{ for } i\in\{x,y,z\}\\ 0 &amp;\mbox{ else }\end{array}\right. \]" src="form_25.png"/>
</p>
</li>
<li>Fourier transform the density in <img class="formulaInl" alt="$ \mathcal{G}_2 $" src="form_24.png"/>: <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \rho_2(\mathbf{r}_{\bnu})\ \longrightarrow\ \tilde{\rho}_2(\mathbf{k}_{\bmu})={\tt FFT}\{\rho_2(\mathbf{r}_{\bnu})\} \]" src="form_26.png"/>
</p>
</li>
<li>Compute solution in <img class="formulaInl" alt="$ k $" src="form_17.png"/>-space by multiplication with the formerly prepared Greens function <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \tilde{U}_2(\mathbf{k}_{\bmu}) =\tilde{G}_2(\mathbf{k}_{\bmu})\tilde{\rho}_2(\mathbf{k}_{\bmu}) \]" src="form_27.png"/>
</p>
</li>
<li>Compute solution in <img class="formulaInl" alt="$ r $" src="form_28.png"/>-space by Fourier back transformation in <img class="formulaInl" alt="$\mathcal{G}_2$" src="form_2.png"/>: <p class="formulaDsp">
<img class="formulaDsp" alt="\[ {U}_2(\mathbf{r}_{\bnu})={\tt FFT}^{-1}\{\tilde{U}_2(\mathbf{k}_{\bmu})\} \]" src="form_29.png"/>
</p>
</li>
<li>Map to standard grid <img class="formulaInl" alt="$ \mathcal{G}_1 $" src="form_23.png"/>: <p class="formulaDsp">
<img class="formulaDsp" alt="\[ {U}_\mathrm{Coul}(\mathbf{r}_{\bnu})=U_2(\mathbf{r}_{\bnu})\quad\mbox{for}\quad\bnu\in\mathcal{G}_1 \]" src="form_30.png"/>
</p>
</li>
</ol>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a74649b61a8f2de130fb95edb9a62d498"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74649b61a8f2de130fb95edb9a62d498">&#9670;&nbsp;</a></span>coulinit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public coulomb::coulinit</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine does the necessary initialization. </p>
<p>It calculates the dimension for the Fourier transform depending on the boundary condition, allocates the necessary arrays and sets up the FFTW plans. Then it composes the array <code>q</code>. For the periodic case this contains the values of the Green's function <img class="formulaInl" alt="$ 1/k^2 $" src="form_33.png"/>, with zero at the origin, while for the isolated case it first calculates the inverse shortest distance $1/r$ from the origin with indices (1,1,1), replaces the value at the origin and then Fourier-transforms this to use it for folding the density with the coordinate-space Green's function. <br  />
 </p>

</div>
</div>
<a id="aee5145182fc0abb626eaa2850a87826c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee5145182fc0abb626eaa2850a87826c">&#9670;&nbsp;</a></span>initiq()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, private coulomb::initiq </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(db), intent(in)&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(db), dimension(:), intent(out)&#160;</td>
          <td class="paramname"><em>iq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This subroutine calculates the contributions of each Cartesian index to <img class="formulaInl" alt="$r^2$" src="form_34.png"/> and <img class="formulaInl" alt="$k^{-2}$" src="form_35.png"/>. </p>
<p>This depends on the boundary condition. For the periodic case, the values of the momenta are given by </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ k_i=\frac{2\pi}{n\Delta x}\bigl(0,\;1,\;2,\;\ldots \frac{n}2-1,\; -\frac{n}2,\;-\frac{n}2+1,\;\ldots -1\bigr).\]" src="form_36.png"/>
</p>
<p> For an isolated distribution the shortest distances to the point with index 1 are calculated (periodicity used): </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ d_i=d\bigl(0,\;1,\;2,\;\ldots \frac{n}2-1,\; -\frac{n}2,-\frac{n}2+1,\;\;\ldots 1\bigr).\]" src="form_37.png"/>
</p>
<p> The input is the dimension along the coordinate direction given, the output is the one-dimensional array <code>iq</code> containing these values squared.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>INTEGER, takes the number of grid points. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">d</td><td>REAL(db), takes the grid spacing. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">iq</td><td>REAL(db), array, returns the values for <img class="formulaInl" alt="$r^2$" src="form_34.png"/> and <img class="formulaInl" alt="$k^{-2}$" src="form_35.png"/>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a5f0400055fa5aa4cbfc054c9e1bf565b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f0400055fa5aa4cbfc054c9e1bf565b">&#9670;&nbsp;</a></span>poisson()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public coulomb::poisson </td>
          <td>(</td>
          <td class="paramtype">real(db), dimension(nx,ny,nz), intent(in)&#160;</td>
          <td class="paramname"><em>rhocharge</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine solves the Poisson equation by the Fourier method. </p>
<p>For the periodic case, this means to just Fourier transform, multiply by <img class="formulaInl" alt="$1/k^2$" src="form_31.png"/>, and the transform back. Note that the coefficient for momentum zero must be zero also: this means that the total charge in the box vanishes, corresponding to the jellium approximation. In the non-periodic case we use use the trick of doubling the box size in every direction and then folding with <img class="formulaInl" alt="$1/r$" src="form_32.png"/> my multiplying the Fourier transforms. The result in the physical box is then the correct solution for the boundary condition of zero potential at infinity. The key to success is not to use simply <img class="formulaInl" alt="$1/k^2$" src="form_31.png"/> for the Fourier transform of <img class="formulaInl" alt="$1/r$" src="form_32.png"/>, but to compute it on the actual grid the same way as the densities and potentials are transformed </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a20877fe904a19406549cfc1e10b30128"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20877fe904a19406549cfc1e10b30128">&#9670;&nbsp;</a></span>coulplan1</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer(c_long), save, private coulomb::coulplan1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="abfd1cdc755ebb2f0adcd1d1ce1cf4503"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abfd1cdc755ebb2f0adcd1d1ce1cf4503">&#9670;&nbsp;</a></span>coulplan2</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer(c_long), save, private coulomb::coulplan2</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a821f17159bc941612225823801555733"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a821f17159bc941612225823801555733">&#9670;&nbsp;</a></span>nx2</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, private coulomb::nx2</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="aec5bb921ae0a248b7ce45c157e9d793d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aec5bb921ae0a248b7ce45c157e9d793d">&#9670;&nbsp;</a></span>ny2</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, private coulomb::ny2</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a0de0e5b7d18f4ce88eeb7ea25839149a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0de0e5b7d18f4ce88eeb7ea25839149a">&#9670;&nbsp;</a></span>nz2</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, private coulomb::nz2</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ad9f62c9032d70f15617f01a0c9ecb0c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9f62c9032d70f15617f01a0c9ecb0c7">&#9670;&nbsp;</a></span>q</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">complex(db), dimension(:,:,:), allocatable, save, private coulomb::q</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>array for the complex Green’s function (isolated) or array of 1/r values. Its dimension also depends on the boundary condition. </p>

</div>
</div>
<a id="a26740de741e0c1efe01fe26e5c996135"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26740de741e0c1efe01fe26e5c996135">&#9670;&nbsp;</a></span>wcoul</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">real(db), dimension(:,:,:), allocatable, save, public coulomb::wcoul</td>
        </tr>
      </table>
</div><div class="memdoc">

<p><br  />
 </p>
<p>the Coulomb potential as a three-dimensional array. Units: MeV. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacecoulomb.html">coulomb</a></li>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
