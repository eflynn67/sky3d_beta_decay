<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sky3D: densities Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Sky3D
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('namespacedensities.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">densities Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This module has two purposes: it defines and allocates the densities and currents making up the mean field, and also contains the subroutine <code>add_density</code> which accumulates the basic densities over the single-particle wave functions. Subroutine <code>skyrme</code> in module <code>Meanfield</code> then uses these densities to build up the components of the single-particle Hamiltonian.  
<a href="namespacedensities.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a6f80e11dd07b8c4f22dcf74f0721072f"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedensities.html#a6f80e11dd07b8c4f22dcf74f0721072f">alloc_densities</a></td></tr>
<tr class="memdesc:a6f80e11dd07b8c4f22dcf74f0721072f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is simply a short routine to allocate all the arrays defined in this module.  <a href="namespacedensities.html#a6f80e11dd07b8c4f22dcf74f0721072f">More...</a><br /></td></tr>
<tr class="separator:a6f80e11dd07b8c4f22dcf74f0721072f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8ae0afd697a04489301a0b4ef54ffc1"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedensities.html#ab8ae0afd697a04489301a0b4ef54ffc1">add_density</a> (iq, weight, psin, lrho, ltau, lcurrent, lsdens, lsodens)</td></tr>
<tr class="memdesc:ab8ae0afd697a04489301a0b4ef54ffc1"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine is given a single-particle wave function <code>psin</code> with its isospin index <code>iq</code> and occupation <img class="formulaInl" alt="$ w_\alpha^2= $" src="form_49.png"/> <code>weight</code> and adds its contribution to the density arrays.  <a href="namespacedensities.html#ab8ae0afd697a04489301a0b4ef54ffc1">More...</a><br /></td></tr>
<tr class="separator:ab8ae0afd697a04489301a0b4ef54ffc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader">Scalar densities:</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p>These are dimensioned <code>(nx,ny,nz,2)</code>, where the last index is 1 for neutrons and 2 for protons. </p>
</div></td></tr>
<tr class="memitem:a48037b3a5426577742a92370d444c2e4"><td class="memItemLeft" align="right" valign="top">real(db), dimension(:,:,:,:), allocatable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedensities.html#a48037b3a5426577742a92370d444c2e4">rho</a></td></tr>
<tr class="memdesc:a48037b3a5426577742a92370d444c2e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">the density, separately for each isospin (in <img class="formulaInl" alt="${\rm fm}^{-3} $" src="form_38.png"/>). The definition is:  <a href="namespacedensities.html#a48037b3a5426577742a92370d444c2e4">More...</a><br /></td></tr>
<tr class="separator:a48037b3a5426577742a92370d444c2e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b6801014c9a122d2672009675eedc4a"><td class="memItemLeft" align="right" valign="top">real(db), dimension(:,:,:,:), allocatable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedensities.html#a0b6801014c9a122d2672009675eedc4a">tau</a></td></tr>
<tr class="memdesc:a0b6801014c9a122d2672009675eedc4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">the kinetic energy density, separately for each isospin. It is defined as the sum of the spin contributions and all particles of the given isospin  <a href="namespacedensities.html#a0b6801014c9a122d2672009675eedc4a">More...</a><br /></td></tr>
<tr class="separator:a0b6801014c9a122d2672009675eedc4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr><td colspan="2"><div class="groupHeader">Vector densities:</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p>These are dimensioned <code>(nx,ny,nz,3,2)</code>, where the last index is 1 for neutrons and 2 for protons, and the next-to-last stands for the Cartesian direction. </p>
</div></td></tr>
<tr class="memitem:a66634aa8189873880d82031b179afbee"><td class="memItemLeft" align="right" valign="top">real(db), dimension(:,:,:,:,:), allocatable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedensities.html#a66634aa8189873880d82031b179afbee">current</a></td></tr>
<tr class="memdesc:a66634aa8189873880d82031b179afbee"><td class="mdescLeft">&#160;</td><td class="mdescRight">this is the total probability current density, defined in the familiar way as  <a href="namespacedensities.html#a66634aa8189873880d82031b179afbee">More...</a><br /></td></tr>
<tr class="separator:a66634aa8189873880d82031b179afbee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa48602f6693fad468577e4da057d21a2"><td class="memItemLeft" align="right" valign="top">real(db), dimension(:,:,:,:,:), allocatable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedensities.html#aa48602f6693fad468577e4da057d21a2">sdens</a></td></tr>
<tr class="memdesc:aa48602f6693fad468577e4da057d21a2"><td class="mdescLeft">&#160;</td><td class="mdescRight">the spin density. It is defined as  <a href="namespacedensities.html#aa48602f6693fad468577e4da057d21a2">More...</a><br /></td></tr>
<tr class="separator:aa48602f6693fad468577e4da057d21a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d52d254fb667eea432179bab9a1e32b"><td class="memItemLeft" align="right" valign="top">real(db), dimension(:,:,:,:,:), allocatable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedensities.html#a7d52d254fb667eea432179bab9a1e32b">sodens</a></td></tr>
<tr class="memdesc:a7d52d254fb667eea432179bab9a1e32b"><td class="mdescLeft">&#160;</td><td class="mdescRight">the spin-orbit density, defined as  <a href="namespacedensities.html#a7d52d254fb667eea432179bab9a1e32b">More...</a><br /></td></tr>
<tr class="separator:a7d52d254fb667eea432179bab9a1e32b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This module has two purposes: it defines and allocates the densities and currents making up the mean field, and also contains the subroutine <code>add_density</code> which accumulates the basic densities over the single-particle wave functions. Subroutine <code>skyrme</code> in module <code>Meanfield</code> then uses these densities to build up the components of the single-particle Hamiltonian. </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="ab8ae0afd697a04489301a0b4ef54ffc1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8ae0afd697a04489301a0b4ef54ffc1">&#9670;&nbsp;</a></span>add_density()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine densities::add_density </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>iq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(db), intent(in)&#160;</td>
          <td class="paramname"><em>weight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">complex(db), dimension(nx,ny,nz,2), intent(inout)&#160;</td>
          <td class="paramname"><em>psin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(db), dimension(:,:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>lrho</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(db), dimension(:,:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>ltau</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(db), dimension(:,:,:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>lcurrent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(db), dimension(:,:,:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>lsdens</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(db), dimension(:,:,:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>lsodens</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine is given a single-particle wave function <code>psin</code> with its isospin index <code>iq</code> and occupation <img class="formulaInl" alt="$ w_\alpha^2= $" src="form_49.png"/> <code>weight</code> and adds its contribution to the density arrays. </p>
<p>The reason for not including the loop over states in the subroutine is that in the dynamic code, the contribution of a new single-particle wave function (calculated by tstep) to the densities is added without saving that wave function, eliminating the requirement for a second huge wave-function array.</p>
<p>It may seem strange that <code>add_density</code> has the densities themselves as parameters, which are readily available in the module. The reason for this is <code>OPENMP</code> parallelization. The loop over wave functions is done in parallel under <code>OPENMP</code>. Since any of the parallel tasks must add up the contributions of its assigned wave functions, each task must have a copy of the densities to work on; otherwise they would try to update the same density at the same time. The separate copies are then combined using the <code>OPENMP</code> <code>REDUCE(+)</code> directive.</p>
<p>The local copies of the densities passed as arrays are denoted with the prefixed letter "l" for <em>local</em>; they are <code>lrho</code>, <code>ltau</code>, <code>lcurrent</code>, <code>lsdens</code>, and <code>lsodens</code>.</p>
<p>If the weight is zero, there is nothing to do and the subroutine returns immediately. Otherwise, the contributions not involving derivatives are first computed and added to the affected densities, i.~e., number and spin density.</p>
<p>After this the derivative terms are evaluated by computing each Cartesian direction separately. In all three cases the derivative is evaluated first and put into <code>ps1</code>, after which the contributions are added straightforwardly. They involve the wave function itself, the derivative, and for the spin-orbit density also a Pauli matrix, so that different spin projections have to be combined properly.</p>
<p>The complex products always in the end evaluate to something real and the expressions are simplified to take this into account. For example, the following transformation is done: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \frac{1}{2\I}(\psi^*\nabla\psi-\psi\nabla\psi^*)&amp;=&amp; \frac{1}{2\I}\left(\psi^*\nabla\psi-(\psi^*\nabla\psi)^*\right)\\ &amp;=&amp;\frac{1}{2\I}\left(2\I\Im(\psi^*\nabla\psi)\right)\\ &amp;\rightarrow&amp;{\tt AIMAG(CONJG(psin)*psi1)} \end{eqnarray*}" src="form_50.png"/>
</p>
<p> and similarly for the other expressions.</p>
<p>The efficiency of this relies on the FORTRAN compiler recognizing that only the imaginary part of the complex product is needed and not computing the real part at all. This seems to be the case with all present compilers.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">iq</td><td>INTEGER, takes the isospin of the wave function. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">weight</td><td>REAL(db), takes the BCS weight of the wave function. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">psin</td><td>CMPLEX(db), array, takes wave function . </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">lrho</td><td>REAL(db), array, takes and adds the density. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ltau</td><td>REAL(db), array, takes and adds the kinetic density. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">lcurrent</td><td>REAL(db), array, takes and adds the current density. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">lsdens</td><td>REAL(db), array, takes and adds the spin density. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">lsodens</td><td>REAL(db), array, takes and adds the spin-orbit density. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a6f80e11dd07b8c4f22dcf74f0721072f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f80e11dd07b8c4f22dcf74f0721072f">&#9670;&nbsp;</a></span>alloc_densities()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine densities::alloc_densities</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is simply a short routine to allocate all the arrays defined in this module. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a66634aa8189873880d82031b179afbee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66634aa8189873880d82031b179afbee">&#9670;&nbsp;</a></span>current</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">real(db), dimension(:,:,:,:,:), allocatable densities::current</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>this is the total probability current density, defined in the familiar way as </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \vec\jmath_q(\vec r) = \frac{1}{2\I}\sum_{\alpha\in q}w_\alpha^2 \sum_s\left(\psi_\alpha^*(\vec r,s)\nabla\psi_\alpha(\vec r,s)-\psi_\alpha(\vec r,s) \nabla\psi_\alpha^*(\vec r,s)\right). \]" src="form_42.png"/>
</p>
<p> Note that the factor <img class="formulaInl" alt="$ \frac{\hbar}{m} $" src="form_43.png"/> is not included. Its units are therefore <img class="formulaInl" alt="$ {\rm fm}^{-4} $" src="form_44.png"/>. </p>

</div>
</div>
<a id="a48037b3a5426577742a92370d444c2e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48037b3a5426577742a92370d444c2e4">&#9670;&nbsp;</a></span>rho</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">real(db), dimension(:,:,:,:), allocatable densities::rho</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>the density, separately for each isospin (in <img class="formulaInl" alt="${\rm fm}^{-3} $" src="form_38.png"/>). The definition is: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \rho_q(\vec r)=\sum_{k\in q}w_k^2\sum_s|\phi_k(\vec r,s)|^2,\qquad q=n,p \]" src="form_39.png"/>
</p>
 
</div>
</div>
<a id="aa48602f6693fad468577e4da057d21a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa48602f6693fad468577e4da057d21a2">&#9670;&nbsp;</a></span>sdens</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">real(db), dimension(:,:,:,:,:), allocatable densities::sdens</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>the spin density. It is defined as </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \vec\sigma_q(\vec r)=\sum_{\alpha\in q} w_\alpha^2 \sum_{ss'}\psi_\alpha^*(\vec r,s)\,\sigma_{ss'} \,\psi_\alpha(\vec r,s').\]" src="form_45.png"/>
</p>
<p> Note that it does not include the factor <img class="formulaInl" alt="$ \hbar/2 $" src="form_46.png"/>. Units: <img class="formulaInl" alt="$ {\rm fm}^{-3} $" src="form_47.png"/>. </p>

</div>
</div>
<a id="a7d52d254fb667eea432179bab9a1e32b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d52d254fb667eea432179bab9a1e32b">&#9670;&nbsp;</a></span>sodens</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">real(db), dimension(:,:,:,:,:), allocatable densities::sodens</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>the spin-orbit density, defined as </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \vec J_q(\vec r)=\frac{1}\I\sum_{\alpha\in q}w_\alpha^2 \sum_{ss'}\left(\psi_\alpha^*(\vec r,s)\nabla\times\sigma_{ss'} \psi_\alpha(\vec r,s')\right).\]" src="form_48.png"/>
</p>
<p> Its units are also <img class="formulaInl" alt="$ {\rm fm}^{-4} $" src="form_44.png"/>. </p>

</div>
</div>
<a id="a0b6801014c9a122d2672009675eedc4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b6801014c9a122d2672009675eedc4a">&#9670;&nbsp;</a></span>tau</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">real(db), dimension(:,:,:,:), allocatable densities::tau</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>the kinetic energy density, separately for each isospin. It is defined as the sum of the spin contributions and all particles of the given isospin </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \tau_q(\vec r)=\sum_{k\in q}w_k^2\sum_s|\nabla\phi_k(\vec r,s)|^2, \qquad q=n,p\]" src="form_40.png"/>
</p>
<p> Note that it does not include the factor <img class="formulaInl" alt="$ \hbar^2/2m $" src="form_41.png"/>. Units: </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacedensities.html">densities</a></li>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
